{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Dashboard | Campus Insight</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="{% static 'images/logo.png' %}" rel="shortcut icon" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link
      href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}"
      rel="stylesheet"
    />
    <link
      href="{% static 'vendor/bootstrap-icons/bootstrap-icons.css' %}"
      rel="stylesheet"
    />
    <link href="{% static 'vendor/aos/aos.css' %}" rel="stylesheet" />
    <link
      href="{% static 'vendor/fontawesome-free/css/all.min.css' %}"
      rel="stylesheet"
    />
    <link
      href="{% static 'vendor/glightbox/css/glightbox.min.css' %}"
      rel="stylesheet"
    />

    <!-- Main CSS File -->
    <link href="{% static 'css/dashboard.css' %}" rel="stylesheet" />
  </head>

  <body class="index-page">
    {% include 'navbar.html' %}

    <main class="main">
      <!-- Page Title -->
      <div class="page-title dark-background" data-aos="fade">
        <div class="container position-relative">
          <h1>Dashboard</h1>
          <p>Your Central Hub for Insights and Management.</p>
          <nav class="breadcrumbs">
            <ol>
              <li><a href="{% url 'home' %}">Home</a></li>
              <li class="current">Dashboard</li>
            </ol>
          </nav>
        </div>
      </div>
      <!-- End Page Title -->

      <!-- Section Title -->
      <section id="starter-section" class="starter-section section">
        <div class="container section-title" data-aos="fade-up">
          <span>Dashboard<br /></span>
          <h2>Dashboard</h2>
          <p>
            Welcome to your Dashboard, the central hub for managing your
            account, tracking your progress, and accessing all the essential
            tools and features you need. Here, you can easily navigate through
            your activities, view important metrics, and stay updated with the
            latest information. Your personalized dashboard is designed to help
            you stay organized and efficient.
          </p>
        </div>
      </section>
      <!-- End Section Title -->

      <!-- Dashboard Section -->
      <div class="container mb-5">
        <div class="row">
          <!-- Sidebar -->
          <div class="col-lg-3 col-md-4 p-3">
            <div class="card">
              <div class="mb-4">
                <h4 class="section-title" style="font-size: 20px">
                  <i class="fas fa-school mr-2" style="color: #007bff"></i>
                  Quick Links
                </h4>
                <ul class="sidebar">
                  <!-- Sidebar Links -->
                  <li>
                    <a
                      href="#"
                      data-target="registrations"
                      aria-label="Registrations"
                    >
                      <i class="fa-solid fa-laptop-file"></i> Registrations
                    </a>
                  </li>
                  <li>
                    <a href="#" data-target="Exams" aria-label="Exams">
                      <i class="fa-solid fa-list"></i> Exams
                    </a>
                  </li>
                  <li>
                    <a href="#" data-target="Results" aria-label="Results">
                      <i class="fa-solid fa-list"></i> Results
                    </a>
                  </li>
                  <li>
                    <a href="#" data-target="settings" aria-label="Settings">
                      <i class="fa-solid fa-square-poll-vertical"></i> Settings
                    </a>
                  </li>
                  <li>
                    <a
                      href="#"
                      data-target="notifications"
                      aria-label="Notifications"
                    >
                      <i class="fa-regular fa-comments"></i> Notifications
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <!-- Main Content -->
          <div class="col-lg-9 col-md-8 p-3">
            <!-- Registrations Section -->
            <div id="registrations" class="container content-section">
              <div class="card">
                <div class="card-body">
                  <h2 style="color: #007bff">Registrations</h2>
                  <p>Registration information goes here.</p>
                  <div id="registrations-list" class="row">
                    <!-- Registration items will be injected here -->
                  </div>
                </div>
              </div>
            </div>
            <!-- End Registrations Section -->

            <!-- Exams Section -->
            <div id="Exams" class="container content-section">
              <div class="card">
                <div class="card-body">
                  <h2 style="color: #007bff">Exams</h2>
                  <p>Exams information goes here.</p>
                  <div class="row mb-3">
                    <div class="col-md-9">
                      <input
                        type="text"
                        id="search-bar"
                        class="form-control"
                        placeholder="Search exams"
                      />
                    </div>
                    <div class="col-md-auto mr-2">
                      <a
                        href="{% url 'exam_creation' %}"
                        class="btn btn-outline-primary"
                        >Create New Exam</a
                      >
                    </div>
                  </div>
                  <div id="exams-list" class="row">
                    <!-- Exam items will be injected here -->
                    {% for exam in exams %}
                    <div class="col-md-6 mb-4">
                      <div class="card">
                        <div class="card-body">
                          <h5 class="card-title">{{ exam.title }}</h5>
                          <p class="card-text">{{ exam.description }}</p>
                          <p class="card-text">
                            <strong>Date:</strong> {{ exam.date }}
                          </p>
                          <p class="card-text">
                            <strong>Duration:</strong> {{ exam.duration }}
                            minutes
                          </p>
                          <div class="align-content-center text-center">
                            <a
                            href="{% url 'edit_exam' exam.id %}"
                            class="btn btn-outline-success mx-2"
                            >Edit Exam</a
                          >
                          <a
                            href="{% url 'edit_question' exam.id %}"
                            class="btn btn-outline-primary mx-2"
                            >Edit Questions</a
                          >
                          <button
                            onclick="confirmDelete({{ exam.id }})"
                            class="btn btn-outline-danger mx-2"
                          >
                            Delete Exam
                          </button>
                        </div>
                        </div>
                      </div>
                    </div>
                    {% empty %}
                    <p>No exams available.</p>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
            <!-- End Exams Section -->

            <!-- Delete Confirmation Modal -->
            <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">
                      Confirm Deletion
                    </h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>
                  <div class="modal-body">
                    Are you sure you want to delete this exam?
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-outline-dark"
                      data-bs-dismiss="modal"
                    >
                      Cancel
                    </button>
                    <button
                      type="button"
                      class="btn btn-outline-danger"
                      id="confirmDeleteButton"
                    >
                      Delete
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- End Delete Confirmation Modal -->

            <!-- Results Section -->
            <div id="Results" class="container content-section">
              <div class="card">
                <div class="card-body">
                  <h2 style="color: #007bff">Results</h2>
                  <p>Results information goes here.</p>
                  <div id="result-list" class="row">
                    <!-- Result items will be injected here -->
                    {% for result in results %}
                    <div
                      class="result-item"
                      style="
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        background-color: #fff;
                        padding: 15px;
                        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                      "
                    >
                      <h4 style="margin: 0; font-size: 18px">
                        {{ result.subject_name }}
                      </h4>
                      <p style="margin: 5px 0; font-size: 16px; color: #333">
                        <strong>Marks:</strong> {{ result.marks_obtained }}
                      </p>
                    </div>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
            <!-- End Results Section -->

            <!-- Settings Section -->
            <div id="settings" class="container content-section" style="display: none">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title mb-4">
                    <i class="fa-solid fa-cog"></i> Settings
                  </h4>
                  <p>Your settings options go here.</p>
                </div>
              </div>
            </div>
            <!-- End Settings Section -->

            <!-- Notifications Section -->
            <div id="notifications" class="container content-section" style="display: none">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title mb-4">
                    <i class="fa-regular fa-bell"></i> Notifications
                  </h4>
                  <p>Your notifications information goes here.</p>
                </div>
              </div>
            </div>
            <!-- End Notifications Section -->
          </div>
        </div>
      </div>
      <!-- End Dashboard Section -->
    </main>

    {% include 'footer.html' %}

    <!-- Scroll Top -->
    <a
      href="#"
      id="scroll-top"
      class="scroll-top d-flex align-items-center justify-content-center"
    >
      <i class="bi bi-arrow-up-short"></i>
    </a>

    <!-- Preloader -->
    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'vendor/aos/aos.js' %}"></script>
    <script src="{% static 'vendor/purecounter/purecounter_vanilla.js' %}"></script>
    <script src="{% static 'vendor/glightbox/js/glightbox.min.js' %}"></script>

    <!-- Main JS File -->
    <script src="{% static 'js/main.js' %}"></script>
    <script>
      // Sidebar navigation
      document.querySelectorAll(".sidebar a").forEach((link) => {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          const targetId = this.getAttribute("data-target");
          document.querySelectorAll(".content-section").forEach((section) => {
            section.style.display = "none";
          });
          document.getElementById(targetId).style.display = "block";
        });
      });
    
      // Show the default section
      document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("Exams").style.display = "block";
      });
    
      // Confirm delete functionality
      function confirmDelete(examId) {
        // Set the exam ID to the confirmation button
        const confirmDeleteButton = document.getElementById('confirmDeleteButton');
        confirmDeleteButton.setAttribute('data-exam-id', examId);
    
        // Show the confirmation modal
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
        deleteModal.show();
      }
    
      // Handle delete confirmation
      document.getElementById('confirmDeleteButton').addEventListener('click', function() {
        const examId = this.getAttribute('data-exam-id');
    
        // Send delete request to the server
        fetch(`/exams/delete/${examId}/`, {
          method: 'DELETE',
          headers: {
            'X-CSRFToken': '{{ csrf_token }}'
          },
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Reload the page after successful deletion
            location.reload();
          } else {
            alert('Failed to delete the exam.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
      });
    </script>       
  </body>
</html>
